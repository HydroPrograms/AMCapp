<!DOCTYPE html>
<html>
    <head>
      
    <style>

        h1 {text-align: center;}
        p {
            text-align: center;
            margin-left: 200px;
            margin-right: 200px;
        }
        select {text-align:center;}
        option {text-align:center;}
        button {text-align:center;}
      </style>
</head>
<body>

        <h1>Generate AMC problems</h1>

        <p id="problem"></p>

        <p id="Problems"> 
        <select id="ddlViewBy">
          <option value=8>AMC 8</option>
          <option value=10>AMC 10</option>
          <option value=12>AMC 12</option>
          <option value="Random" selected="selected">Random</option>
        </select>
        <button type="button" id="new_problem">New problem</button>
        <button type="button" onclick="Answer()">Answer</button>
        <span style="display: none;" id="get_answer">hihihihi</span>
        
        <a target="_blank" href="" id="SolutionLink">Solution</a>
        </p>
    <script>
        document.getElementById("new_problem").onclick = function() {get_new_problem()};

function Answer() {
      var x = document.getElementById("get_answer");
      if (x.style.display === "none") {
          x.style.display = "block";
      } else {
          x.style.display = "none";
      }
}

var HttpClient = function() {
    this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open( "GET", aUrl, true );            
        anHttpRequest.send( null );
    }
}

function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;

      // While there remain elements to shuffle...
      while (0 !== currentIndex) {

              // Pick a remaining element...
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;

              // And swap it with the current element.
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
            }

      return array;
}

function getRandomIntInclusive(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and the minimum is inclusive
}

function get_new_problem() {
      var type = document.getElementById("ddlViewBy").value;
      if (type == "Random") {
          var arr1 = shuffle([8, 10, 12]);
          type = arr1[0];
      }

      var if_ab = true;

      var arr2 = [];
      for (i = 2000; i < 2021; i++){
          arr2.push(i)
      }
      arr2 = shuffle(arr2);
      yr = arr2[0];

      if (type == 8) {
          if_ab = false;
      } else if ((type == 10 || type == 12) && (yr < 2002)) {
          if_ab = false;
      }

      var arr3 = []
      for (i = 1; i < 26; i++){
          arr3.push(i)
      }
      arr3 = shuffle(arr3);
      prob = arr3[0];
      
      var year    =     yr.toString();
      var amc     =     type.toString();
      var problem =     prob.toString();
      
      var link = "";
      var answer_key_link = "";
      if (if_ab == true) {
          a_b = shuffle(["A", "B"]);
          a_b = a_b[0];
          var aorb = a_b.toString();
          link = link.concat("https://cors-anywhere.herokuapp.com/https://artofproblemsolving.com/wiki/index.php?title=", year, "_AMC_", amc, aorb, "_Problems/Problem_", problem);
          answer_key_link = answer_key_link.concat("https://cors-anywhere.herokuapp.com/https://artofproblemsolving.com/wiki/index.php?title=", year, "_AMC_", amc, aorb, "_Answer_Key");
      } else {
          link = link.concat("https://cors-anywhere.herokuapp.com/https://artofproblemsolving.com/wiki/index.php?title=", year, "_AMC_", amc, "_Problems/Problem_", problem);
          answer_key_link = answer_key_link.concat("https://cors-anywhere.herokuapp.com/https://artofproblemsolving.com/wiki/index.php?title=", year, "_AMC_", amc, "_Answer_Key_");
      }
      

      var solutions = link.split("https://cors-anywhere.herokuapp.com/")[1];
      var SolutionTag = document.getElementById('SolutionLink');
      SolutionTag.setAttribute("href", solutions);

      var url = link; 

      let xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.send();

      xhr.onreadystatechange = processRequest;
      function processRequest(e) {
          if (xhr.readyState == 4 && xhr.status == 200) {
              var response = xhr.responseText;
              response = response.replaceAll("'", '"');
              response = response.replaceAll('<a href=\"', '<a href=\"https://www.artofproblemsolving.com');
              response = response.replaceAll("//latex.artofproblemsolving.com", "https://latex.artofproblemsolving.com");
              response = response.split("</span></h2>")[1].split("<h2>")[0];
              response = response.replaceAll("</p><p><img src=", "<br></br></p><p><img src=");
              console.log(link);
              console.log(response);
              document.getElementById("problem").innerHTML = response;
      
      let xhr2 = new XMLHttpRequest();
      xhr2.open('GET', answer_key_link, true);
      xhr2.send()

      xhr2.onreadystatechange = processRequest;
      function processRequest(e) {
          if (xhr2.readyState == 4 && xhr2.status == 200) {
              var response2 = xhr2.responseText;
              response2 = response2.split('<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output">')[1];
              response2 = response2.split('<!--')[0];
              response2 = response2.split('<li>');
              response2 = response2[problem];
              response2 = response2.substring(0);
              console.log(answer_key_link);
              console.log(response2);
              document.getElementById("get_answer").innerHTML = response2;
          }
      }
          }
      }
        
}
    </script>

    </body>
</html>

